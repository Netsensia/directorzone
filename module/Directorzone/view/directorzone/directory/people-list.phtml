<?php echo $this->partial('directory-nav.phtml'); ?>
<h3>People directory</h3>

<table id="people" class="table table-striped table-bordered table-hover">
<tr><th>Name</th><th>Company</th><th>Appointment Type</th><th>Date of Birth</th></tr>
</table>

<ul class="pager">
<li class="previous" id="previous" class="disabled"><a href="#">&larr; Previous</a></li>
<li class="next" id="next"><a href="#">Next &rarr;</a></li>
</ul>

<script>

$(document).ready(function() {
	var page = 1;
	var size = 10;

	$("li#next").click(function() {
		page ++;
		loadTable(page, size);
	});

	$("li#previous").click(function() {
		if (!$(this).hasClass('disabled')) {
    		page --;
    		loadTable(page, size);
		}
	});

	loadTable(page, size);	
});

function loadTable(page, size)
{
	$('table#people').find("tr:gt(0)").remove();

	$('table#people tr:last').after(
		'<tr>' +
		'<td style="text-align:center" colspan="5"><img src="/img/ajax/ajax-loader.gif"></td>' +
		'</tr>'
    );
	
	var url = "/ajax/people/list?page=" + page + "&size=" + size;

	$.ajax({
		url: url
	}).done(function(data) {

		$('table#people').find("tr:gt(0)").remove();
				
		$('li#next').removeClass('disabled');
		$('li#previous').removeClass('disabled');
		
		if (data.total <= page * size) {
			$('li#next').addClass('disabled');
		}

		if (page == 1) {
			$('li#previous').addClass('disabled');
		}

		$.each(data.results, function(key, value) {
			var newRow = '<tr>';
			newRow += '<td>' + value.name + '</td>';
			newRow += '<td>' + value.companyname + '</td>';
			newRow += '<td>' + value.appointmenttype + '</td>';
			newRow += '<td>' + value.dob + '</td>';
			newRow += '</tr>';
			
    		$('table#people tr:last').after(newRow);
    	});
	});
}

</script>